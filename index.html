<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÏùòÏÇ¨Í≤∞Ï†ï Ìä∏Î¶¨ ÏãúÎÆ¨Î†àÏù¥ÌÑ∞</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel (JSX Î≥ÄÌôòÏö©) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.3s ease-out forwards;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 font-sans">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ÏïÑÏù¥ÏΩò Ïª¥Ìè¨ÎÑåÌä∏ ÎûòÌçº ---
        // Lucide ÏïÑÏù¥ÏΩòÏùÑ ReactÏóêÏÑú ÏâΩÍ≤å Ïì∞Í∏∞ ÏúÑÌïú Ïª¥Ìè¨ÎÑåÌä∏
        const Icon = ({ name, size = 16, className = "" }) => {
            const iconRef = useRef(null);
            
            useEffect(() => {
                lucide.createIcons({
                    root: iconRef.current,
                    nameAttr: 'data-lucide',
                    attrs: {
                        width: size,
                        height: size,
                        class: className
                    }
                });
            }, [name, size, className]);

            return <span ref={iconRef}><i data-lucide={name}></i></span>;
        };

        // --- Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ± Ìó¨Ìçº ---
        const generateRandomShapes = () => {
            const shapes = ['circle', 'triangle', 'square'];
            const colors = ['red', 'blue', 'yellow'];
            let items = [];
            let idCounter = 1;

            shapes.forEach(shape => {
                colors.forEach(color => {
                    const count = Math.floor(Math.random() * 6); 
                    for (let i = 0; i < count; i++) {
                        const colorName = color === 'red' ? 'Îπ®Í∞ÑÏÉâ' : color === 'blue' ? 'ÌååÎûÄÏÉâ' : 'ÎÖ∏ÎûÄÏÉâ';
                        const shapeName = shape === 'circle' ? 'Ïõê' : shape === 'triangle' ? 'ÏÇºÍ∞ÅÌòï' : 'ÏÇ¨Í∞ÅÌòï';
                        items.push({
                            id: idCounter++,
                            shape,
                            color,
                            name: `${colorName} ${shapeName}`
                        });
                    }
                });
            });

            if (items.length < 3) return generateRandomShapes();
            return items.sort(() => Math.random() - 0.5); 
        };

        // --- Ï¥àÍ∏∞ ÎÖ∏Îìú Îç∞Ïù¥ÌÑ∞ ---
        const INITIAL_NODES = {
            'root': { id: 'root', type: 'question', text: 'Î™®ÏñëÏù¥ ÎèôÍ∑∏ÎûÄÍ∞ÄÏöî?', yesId: 'n_circle', noId: 'n_not_circle', rule: { key: 'shape', value: 'circle' } },
            
            // 1. Circle Branch
            'n_circle': { id: 'n_circle', type: 'question', text: 'ÏÉâÍπîÏù¥ Îπ®Í∞ÑÏÉâÏù∏Í∞ÄÏöî?', parentId: 'root', yesId: 'res_red_circle', noId: 'n_circle_blue', rule: { key: 'color', value: 'red' } },
            'res_red_circle': { id: 'res_red_circle', type: 'result', text: 'Îπ®Í∞ÑÏÉâ Ïõê', parentId: 'n_circle' },
            'n_circle_blue': { id: 'n_circle_blue', type: 'question', text: 'ÏÉâÍπîÏù¥ ÌååÎûÄÏÉâÏù∏Í∞ÄÏöî?', parentId: 'n_circle', yesId: 'res_blue_circle', noId: 'res_yellow_circle', rule: { key: 'color', value: 'blue' } },
            'res_blue_circle': { id: 'res_blue_circle', type: 'result', text: 'ÌååÎûÄÏÉâ Ïõê', parentId: 'n_circle_blue' },
            'res_yellow_circle': { id: 'res_yellow_circle', type: 'result', text: 'ÎÖ∏ÎûÄÏÉâ Ïõê', parentId: 'n_circle_blue' },
            
            // 2. Not Circle Branch
            'n_not_circle': { id: 'n_not_circle', type: 'question', text: 'Î™®ÏñëÏù¥ Îæ∞Ï°±ÌïúÍ∞ÄÏöî? (ÏÇºÍ∞ÅÌòï)', parentId: 'root', yesId: 'n_tri', noId: 'n_square', rule: { key: 'shape', value: 'triangle' } },
            
            // 3. Triangle Branch
            'n_tri': { id: 'n_tri', type: 'question', text: 'ÏÉâÍπîÏù¥ ÎÖ∏ÎûÄÏÉâÏù∏Í∞ÄÏöî?', parentId: 'n_not_circle', yesId: 'res_yellow_tri', noId: 'n_tri_red', rule: { key: 'color', value: 'yellow' } },
            'res_yellow_tri': { id: 'res_yellow_tri', type: 'result', text: 'ÎÖ∏ÎûÄÏÉâ ÏÇºÍ∞ÅÌòï', parentId: 'n_tri' },
            'n_tri_red': { id: 'n_tri_red', type: 'question', text: 'ÏÉâÍπîÏù¥ Îπ®Í∞ÑÏÉâÏù∏Í∞ÄÏöî?', parentId: 'n_tri', yesId: 'res_red_tri', noId: 'res_blue_tri', rule: { key: 'color', value: 'red' } },
            'res_red_tri': { id: 'res_red_tri', type: 'result', text: 'Îπ®Í∞ÑÏÉâ ÏÇºÍ∞ÅÌòï', parentId: 'n_tri_red' },
            'res_blue_tri': { id: 'res_blue_tri', type: 'result', text: 'ÌååÎûÄÏÉâ ÏÇºÍ∞ÅÌòï', parentId: 'n_tri_red' },

            // 4. Square Branch
            'n_square': { 
                id: 'n_square', type: 'question', text: 'ÏÉâÍπîÏù¥ Îπ®Í∞ÑÏÉâÏù∏Í∞ÄÏöî?', parentId: 'n_not_circle', 
                yesId: 'res_red_square', noId: 'n_square_blue', 
                rule: { key: 'color', value: 'red' } 
            },
            'res_red_square': { id: 'res_red_square', type: 'result', text: 'Îπ®Í∞ÑÏÉâ ÏÇ¨Í∞ÅÌòï', parentId: 'n_square' },
            
            'n_square_blue': { 
                id: 'n_square_blue', type: 'question', text: 'ÏÉâÍπîÏù¥ ÌååÎûÄÏÉâÏù∏Í∞ÄÏöî?', parentId: 'n_square', 
                yesId: 'res_blue_square', noId: 'res_yellow_square', 
                rule: { key: 'color', value: 'blue' } 
            },
            'res_blue_square': { id: 'res_blue_square', type: 'result', text: 'ÌååÎûÄÏÉâ ÏÇ¨Í∞ÅÌòï', parentId: 'n_square_blue' },
            'res_yellow_square': { id: 'res_yellow_square', type: 'result', text: 'ÎÖ∏ÎûÄÏÉâ ÏÇ¨Í∞ÅÌòï', parentId: 'n_square_blue' },
        };

        // --- Ïú†Ìã∏Î¶¨Ìã∞ Ìï®Ïàò ---
        const getShapesAtNode = (nodeId, nodes, allShapes) => {
            if (nodeId === 'root') return allShapes;
            const node = nodes[nodeId];
            if (!node.parentId) return []; 
            const parentShapes = getShapesAtNode(node.parentId, nodes, allShapes);
            const parentNode = nodes[node.parentId];
            if (parentNode.type === 'question' && parentNode.rule) {
                const isYesPath = parentNode.yesId === nodeId;
                return parentShapes.filter(shape => {
                const shapeVal = shape[parentNode.rule.key];
                const ruleVal = parentNode.rule.value;
                return isYesPath ? shapeVal === ruleVal : shapeVal !== ruleVal;
                });
            }
            return parentShapes;
        };

        // --- Î©îÏù∏ Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖò Ïª¥Ìè¨ÎÑåÌä∏ ---
        function DecisionTreeApp() {
            const [nodes, setNodes] = useState(INITIAL_NODES);
            const [appMode, setAppMode] = useState('home');
            const [shapeData, setShapeData] = useState([]);
            const [isAnimating, setIsAnimating] = useState(false);

            // Solver/Game State
            const [currentNodeId, setCurrentNodeId] = useState(null);
            const [path, setPath] = useState([]);
            const [targetShape, setTargetShape] = useState(null);
            const [isRevealed, setIsRevealed] = useState(false);
            const [computerThinking, setComputerThinking] = useState(false);
            const [computerAnswer, setComputerAnswer] = useState(null);

            // Builder State
            const [selectedNodeId, setSelectedNodeId] = useState(null);

            useEffect(() => {
                setShapeData(generateRandomShapes());
            }, []);

            // --- Data Actions ---
            const refreshData = () => {
                setIsAnimating(true);
                setTimeout(() => setIsAnimating(false), 500);
                const newData = generateRandomShapes();
                setShapeData(newData);
                if (appMode === 'solver') {
                    resetSolver(newData);
                }
            };

            // --- Navigation Actions ---
            const goHome = () => {
                setAppMode('home');
                resetGame();
            };

            const startBuilder = () => {
                setAppMode('builder');
            };

            const startSolver = () => {
                setAppMode('solver');
                resetSolver(shapeData); 
            };

            const switchToBuilder = (nodeId) => {
                setAppMode('builder');
                setSelectedNodeId(nodeId);
            };

            const resetGame = () => {
                setCurrentNodeId(null);
                setPath([]);
                setIsRevealed(false);
                setTargetShape(null);
                setSelectedNodeId(null);
                setComputerAnswer(null);
                setComputerThinking(false);
            };

            const resetSolver = (data) => {
                setCurrentNodeId('root');
                setPath(['root']);
                setIsRevealed(false);
                setComputerAnswer(null);
                setComputerThinking(false);
                
                if (data.length > 0) {
                    const random = data[Math.floor(Math.random() * data.length)];
                    setTargetShape(random);
                }
            };

            // --- Solver Logic ---
            const handleAskComputer = () => {
                if (!currentNodeId || !targetShape) return;
                const node = nodes[currentNodeId];
                if (node.type !== 'question' || !node.rule) return;

                setComputerThinking(true);

                setTimeout(() => {
                    const shapeVal = targetShape[node.rule.key];
                    const ruleVal = node.rule.value;
                    const isMatch = shapeVal === ruleVal;
                    const answer = isMatch ? 'yes' : 'no';
                    const nextId = isMatch ? node.yesId : node.noId;

                    setComputerThinking(false);
                    setComputerAnswer(answer);

                    setTimeout(() => {
                        if (nextId && nodes[nextId]) {
                        setCurrentNodeId(nextId);
                        setPath(prev => [...prev, nextId]);
                        setComputerAnswer(null);
                        }
                    }, 1500);

                }, 800);
            };

            // --- Builder Actions ---
            const updateNodeText = (id, text) => {
                setNodes(prev => ({ ...prev, [id]: { ...prev[id], text } }));
            };

            const updateNodeRule = (id, key, value) => {
                const shapeNames = { circle: 'ÏõêÌòï', triangle: 'ÏÇºÍ∞ÅÌòï', square: 'ÏÇ¨Í∞ÅÌòï' };
                const colorNames = { red: 'Îπ®Í∞ÑÏÉâ', blue: 'ÌååÎûÄÏÉâ', yellow: 'ÎÖ∏ÎûÄÏÉâ' };

                let newText = "";
                if (key === 'shape') {
                    newText = `Î™®ÏñëÏù¥ ${shapeNames[value] || value}Ïù∏Í∞ÄÏöî?`;
                } else {
                    newText = `ÏÉâÍπîÏù¥ ${colorNames[value] || value}Ïù∏Í∞ÄÏöî?`;
                }

                setNodes(prev => ({
                    ...prev,
                    [id]: { 
                        ...prev[id], 
                        text: newText,
                        rule: { key, value } 
                    }
                }));
            };

            const addBranch = (parentId) => {
                const parent = nodes[parentId];
                if (parent.type === 'result') {
                    const newYesId = `n${Date.now()}_y`;
                    const newNoId = `n${Date.now()}_n`;
                    const newYesNode = { id: newYesId, type: 'result', text: 'Í≤∞Í≥º A', parentId };
                    const newNoNode = { id: newNoId, type: 'result', text: 'Í≤∞Í≥º B', parentId };
                    setNodes(prev => ({
                        ...prev,
                        [parentId]: { 
                            ...prev[parentId], type: 'question', text: 'Î™®ÏñëÏù¥ ÎèôÍ∑∏ÎûÄÍ∞ÄÏöî?', 
                            yesId: newYesId, noId: newNoId, rule: { key: 'shape', value: 'circle' } 
                        },
                        [newYesId]: newYesNode,
                        [newNoId]: newNoNode
                    }));
                }
            };

            const deleteChildren = (nodeId) => {
                setNodes(prev => {
                    const node = prev[nodeId];
                    return {
                        ...prev,
                        [nodeId]: { ...node, type: 'result', yesId: undefined, noId: undefined, rule: undefined }
                    };
                });
            };

            // --- Components ---
            const ShapeIcon = ({ item, size = 16 }) => {
                const colorMap = { red: '#ef4444', blue: '#3b82f6', yellow: '#eab308' };
                const fill = colorMap[item.color];
                let shapeEl = null;
                if (item.shape === 'circle') shapeEl = <circle cx="50" cy="50" r="45" fill={fill} />;
                else if (item.shape === 'square') shapeEl = <rect x="10" y="10" width="80" height="80" fill={fill} />;
                else if (item.shape === 'triangle') shapeEl = <polygon points="50,5 95,90 5,90" fill={fill} />;
                return <svg width={size} height={size} viewBox="0 0 100 100" className="inline-block drop-shadow-sm transition-all duration-500">{shapeEl}</svg>;
            };

            // --- Recursive Tree Node ---
            const TreeNode = ({ nodeId }) => {
                const node = nodes[nodeId];
                if (!node) return null;

                const isSelected = selectedNodeId === nodeId;
                const isCurrent = currentNodeId === nodeId;
                const isInPath = path.includes(nodeId);
                const isResult = node.type === 'result';

                const shapesAtNode = getShapesAtNode(nodeId, nodes, shapeData);
                const isPure = shapesAtNode.length > 0 && shapesAtNode.every(s => s.name === shapesAtNode[0].name);

                let bubbleClass = "flex flex-col items-center p-3 rounded-xl border-2 transition-all duration-300 cursor-pointer min-w-[140px] max-w-[180px] bg-white ";
                
                if (appMode === 'solver') {
                    if (isCurrent) bubbleClass += "border-blue-600 text-blue-900 shadow-xl ring-4 ring-blue-100 scale-105 z-20 ";
                    else if (isInPath) bubbleClass += "border-blue-300 text-blue-800 bg-blue-50 ";
                    else bubbleClass += "border-slate-200 text-slate-400 opacity-50 ";
                } else if (appMode === 'builder') {
                    if (isSelected) bubbleClass += "border-indigo-500 text-indigo-900 shadow-md ring-2 ring-indigo-100 ";
                    else bubbleClass += "border-slate-200 text-slate-700 hover:border-indigo-300 ";
                }

                return (
                    <div className="relative flex flex-col items-center z-10">
                        <div 
                            className={bubbleClass}
                            onClick={(e) => { 
                                e.stopPropagation(); 
                                if (appMode === 'builder') setSelectedNodeId(nodeId); 
                            }}
                        >
                            <div className="text-[10px] font-bold mb-1 flex items-center gap-1 opacity-70 uppercase tracking-wider">
                                {isResult ? 'Result' : 'Question'}
                            </div>
                            <div className="text-center font-medium text-sm leading-tight mb-2 break-keep">
                                {node.text}
                            </div>

                            {appMode === 'builder' ? (
                                <div className="w-full pt-2 border-t border-slate-100 mt-1">
                                    <div className={`flex flex-wrap gap-1 justify-center max-w-[120px] transition-opacity duration-500 ${isAnimating ? 'opacity-50' : 'opacity-100'}`}>
                                        {shapesAtNode.map(s => (
                                        <div key={s.id} className="rounded-full transition-transform hover:scale-150">
                                            <ShapeIcon item={s} size={10} />
                                        </div>
                                        ))}
                                        {shapesAtNode.length === 0 && <span className="text-[10px] text-slate-300">-</span>}
                                    </div>
                                    <div className="text-[10px] text-slate-400 mt-1 text-center flex justify-center items-center gap-1">
                                        {shapesAtNode.length} items 
                                        {isResult && isPure && <Icon name="check-circle" size={10} className="text-green-500"/>}
                                    </div>
                                </div>
                            ) : (
                                <div className="w-full pt-2 border-t border-slate-100 mt-1">
                                    {isResult && isRevealed && isCurrent ? (
                                        <div className="flex flex-wrap gap-1 justify-center max-w-[120px] animate-pulse">
                                            {shapesAtNode.map(s => (
                                                <ShapeIcon key={s.id} item={s} size={12} />
                                            ))}
                                            {shapesAtNode.length === 0 && <span className="text-xs text-slate-400">ÏóÜÏùå</span>}
                                        </div>
                                    ) : (
                                        <div className="flex justify-center items-center gap-1 text-xs font-bold text-slate-400">
                                            <Icon name="help-circle" size={12} />
                                            <span>{shapesAtNode.length} candidates</span>
                                        </div>
                                    )}
                                </div>
                            )}
                        </div>

                        {node.yesId && node.noId && (
                            <div className="flex items-start mt-8 relative">
                                <div className="absolute top-[-2rem] left-1/2 -translate-x-1/2 w-px h-8 bg-slate-300"></div>
                                <div className="absolute top-0 left-1/4 right-1/4 h-px bg-slate-300"></div>
                                
                                <div className="flex flex-col items-center px-4 relative">
                                    <div className={`absolute top-[-0.75rem] left-1/2 -translate-x-1/2 text-[10px] font-bold px-2 py-0.5 rounded-full border bg-white z-20 transition-all duration-300
                                        ${appMode === 'solver' && path.includes(node.yesId) && path.includes(nodeId) ? "text-green-600 border-green-200 bg-green-50 scale-110" : "text-slate-400 border-slate-200"}
                                        ${appMode === 'solver' && isCurrent && computerAnswer === 'yes' ? "ring-4 ring-green-200 scale-125 border-green-600 text-green-700" : ""}
                                    `}>Yes</div>
                                    <div className="w-px h-8 bg-slate-300"></div>
                                    <TreeNode nodeId={node.yesId} />
                                </div>

                                <div className="flex flex-col items-center px-4 relative">
                                    <div className={`absolute top-[-0.75rem] left-1/2 -translate-x-1/2 text-[10px] font-bold px-2 py-0.5 rounded-full border bg-white z-20 transition-all duration-300
                                        ${appMode === 'solver' && path.includes(node.noId) && path.includes(nodeId) ? "text-red-600 border-red-200 bg-red-50 scale-110" : "text-slate-400 border-slate-200"}
                                        ${appMode === 'solver' && isCurrent && computerAnswer === 'no' ? "ring-4 ring-red-200 scale-125 border-red-600 text-red-700" : ""}
                                    `}>No</div>
                                    <div className="w-px h-8 bg-slate-300"></div>
                                    <TreeNode nodeId={node.noId} />
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            // --- Home Screen ---
            if (appMode === 'home') {
                return (
                    <div className="min-h-screen bg-slate-50 flex flex-col items-center justify-center p-6">
                        <h1 className="text-3xl font-bold text-slate-800 mb-2">ÏùòÏÇ¨Í≤∞Ï†ï Ìä∏Î¶¨ ÏãúÎÆ¨Î†àÏù¥ÌÑ∞</h1>
                        <p className="text-slate-500 mb-8 text-center max-w-md">Îç∞Ïù¥ÌÑ∞Î•º Î∂ÑÎ•òÌïòÎäî ÎÖºÎ¶¨Î•º ÏßÅÏ†ë ÎßåÎì§Í±∞ÎÇò, <br/> Ïª¥Ìì®ÌÑ∞Ïùò ÎπÑÎ∞Ä Ï†ïÏ≤¥Î•º ÏßàÎ¨∏ÏùÑ ÌÜµÌï¥ Î∞ùÌòÄÎ≥¥ÏÑ∏Ïöî.</p>
                        
                        <div className="flex gap-4 mb-12">
                            <button onClick={refreshData} className="flex items-center gap-2 px-5 py-2.5 bg-white border border-slate-300 rounded-full hover:bg-indigo-50 hover:border-indigo-200 hover:text-indigo-600 text-slate-600 text-sm font-bold transition shadow-sm group">
                                <Icon name="dice-5" size={18} className={`transition-transform group-hover:rotate-180 ${isAnimating ? 'animate-spin' : ''}`} /> 
                                Îç∞Ïù¥ÌÑ∞ ÎûúÎç§ ÏÖîÌîå (ÌòÑÏû¨ {shapeData.length}Í∞ú)
                            </button>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6 w-full max-w-3xl">
                            <button onClick={startBuilder} className="group bg-white p-8 rounded-2xl shadow-sm border border-slate-200 hover:border-indigo-500 hover:shadow-xl hover:shadow-indigo-100 transition-all text-left flex flex-col items-start">
                                <div className="bg-indigo-100 p-4 rounded-xl mb-4 group-hover:scale-110 transition-transform">
                                    <Icon name="git-branch" size={32} className="text-indigo-600" />
                                </div>
                                <h2 className="text-xl font-bold text-slate-800 mb-2">ÏßàÎ¨∏ ÎßåÎì§Í∏∞ (Builder)</h2>
                                <p className="text-sm text-slate-500">ÎûúÎç§ÌïòÍ≤å ÏÉùÏÑ±Îêú <strong>{shapeData.length}Í∞ú</strong>Ïùò ÎèÑÌòïÏù¥ ÏôÑÎ≤ΩÌïòÍ≤å Î∂ÑÎ•òÎêòÎèÑÎ°ù ÏßàÎ¨∏ Ìä∏Î¶¨Î•º ÏÑ§Í≥ÑÌï©ÎãàÎã§. ÎÖºÎ¶¨Î•º ÏôÑÏÑ±ÌïòÏÑ∏Ïöî.</p>
                            </button>

                            <button onClick={startSolver} className="group bg-white p-8 rounded-2xl shadow-sm border border-slate-200 hover:border-blue-500 hover:shadow-xl hover:shadow-blue-100 transition-all text-left flex flex-col items-start">
                                <div className="bg-blue-100 p-4 rounded-xl mb-4 group-hover:scale-110 transition-transform">
                                    <Icon name="bot" size={32} className="text-blue-600" />
                                </div>
                                <h2 className="text-xl font-bold text-slate-800 mb-2">Ï†ïÏ≤¥ ÎßûÏ∂îÍ∏∞ (Solver)</h2>
                                <p className="text-sm text-slate-500">Ïª¥Ìì®ÌÑ∞Í∞Ä ÎπÑÎ∞ÄÎ¶¨Ïóê ÎèÑÌòï ÌïòÎÇòÎ•º ÏÑ†ÌÉùÌï©ÎãàÎã§. Ïª¥Ìì®ÌÑ∞ÏóêÍ≤å ÏßàÎ¨∏ÏùÑ ÎçòÏ†∏ Í∑∏ Ï†ïÏ≤¥Í∞Ä Î¨¥ÏóáÏù∏ÏßÄ Ï∂îÎ¶¨Ìï¥Î≥¥ÏÑ∏Ïöî.</p>
                            </button>
                        </div>
                    </div>
                );
            }

            // --- Main Layout ---
            return (
                <div className="min-h-screen bg-slate-50 font-sans text-slate-900 flex flex-col">
                    {/* Header */}
                    <header className={`px-6 py-3 border-b flex items-center justify-between sticky top-0 z-50 shadow-sm ${appMode === 'builder' ? 'bg-indigo-600 border-indigo-700 text-white' : 'bg-white border-slate-200 text-slate-800'}`}>
                        <div className="flex items-center gap-3">
                            <button onClick={goHome} className={`p-2 rounded-lg transition ${appMode === 'builder' ? 'hover:bg-indigo-500 text-white' : 'hover:bg-slate-100 text-slate-600'}`}>
                                <Icon name="arrow-left" size={20} />
                            </button>
                            <div>
                                <h1 className="text-lg font-bold flex items-center gap-2">
                                    <Icon name={appMode === 'builder' ? 'git-branch' : 'bot'} size={18} />
                                    {appMode === 'builder' ? 'ÏßàÎ¨∏ ÏÉùÏÑ±Í∏∞ (Builder)' : 'Ïª¥Ìì®ÌÑ∞ Ï†ïÏ≤¥ ÎßûÏ∂îÍ∏∞'}
                                </h1>
                            </div>
                        </div>
                        <div className="flex items-center gap-4">
                            <button 
                                onClick={refreshData}
                                className={`flex items-center gap-2 px-3 py-1.5 rounded-md text-xs font-bold transition active:scale-95
                                    ${appMode === 'builder' ? 'bg-indigo-700 hover:bg-indigo-500 text-white' : 'bg-slate-100 hover:bg-slate-200 text-slate-700'}
                                `}
                            >
                                <Icon name="rotate-ccw" size={12} className={isAnimating ? 'animate-spin' : ''} /> Îç∞Ïù¥ÌÑ∞ ÏÖîÌîå
                            </button>
                        </div>
                    </header>

                    <main className="flex-1 overflow-hidden flex">
                        {/* Sidebar */}
                        <aside className="w-80 bg-white border-r border-slate-200 flex flex-col z-40 shadow-xl">
                            
                            {/* Solver Sidebar */}
                            {appMode === 'solver' && (
                                <div className="flex-1 flex flex-col">
                                    <div className="p-6 bg-slate-800 text-white border-b border-slate-700 text-center relative overflow-hidden">
                                        <div className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-4 relative z-10">Computer's Secret</div>
                                        <div className="inline-flex flex-col items-center justify-center w-24 h-24 rounded-2xl bg-slate-700 border border-slate-600 mb-2 relative z-10">
                                            <Icon name="bot" size={48} className="text-slate-400" />
                                            <span className="text-xs font-bold text-slate-300 mt-2">Secret</span>
                                        </div>
                                        <div className="absolute top-0 left-0 w-full h-full bg-blue-900 opacity-20 animate-pulse"></div>
                                    </div>

                                    <div className="flex-1 p-6 overflow-y-auto bg-slate-50">
                                        {currentNodeId && nodes[currentNodeId] ? (
                                            <div className="animate-fade-in">
                                                <div className="flex justify-between items-center mb-2">
                                                    <div className="text-sm font-bold text-slate-400">ÌòÑÏû¨ ÏßàÎ¨∏</div>
                                                    <button 
                                                        onClick={() => switchToBuilder(currentNodeId)} 
                                                        className="text-xs flex items-center gap-1 text-blue-600 hover:underline"
                                                    >
                                                        <Icon name="wrench" size={10}/> ÏßàÎ¨∏ ÏàòÏ†ï
                                                    </button>
                                                </div>
                                                
                                                <div className="text-xl font-bold text-slate-800 mb-6 leading-snug bg-white p-4 rounded-xl border border-slate-200 shadow-sm">
                                                    {nodes[currentNodeId].text}
                                                </div>

                                                {nodes[currentNodeId].type === 'question' ? (
                                                    <div className="space-y-4">
                                                        {!computerThinking && !computerAnswer ? (
                                                            <button 
                                                                onClick={handleAskComputer}
                                                                className="w-full py-4 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-bold shadow-lg shadow-blue-200 transition transform active:scale-95 flex items-center justify-center gap-2"
                                                            >
                                                                <Icon name="message-square" size={20} />
                                                                Ïª¥Ìì®ÌÑ∞ÏóêÍ≤å ÏßàÎ¨∏ÌïòÍ∏∞
                                                            </button>
                                                        ) : (
                                                            <div className="w-full py-4 bg-white border-2 border-blue-100 rounded-xl flex flex-col items-center justify-center h-[120px]">
                                                                {computerThinking ? (
                                                                    <div className="flex flex-col items-center gap-2">
                                                                        <div className="flex gap-1">
                                                                            <span className="w-2 h-2 bg-blue-600 rounded-full animate-bounce" style={{animationDelay: '0s'}}></span>
                                                                            <span className="w-2 h-2 bg-blue-600 rounded-full animate-bounce" style={{animationDelay: '0.1s'}}></span>
                                                                            <span className="w-2 h-2 bg-blue-600 rounded-full animate-bounce" style={{animationDelay: '0.2s'}}></span>
                                                                        </div>
                                                                        <span className="text-xs font-bold text-blue-600">ÏÉùÍ∞Å Ï§ë...</span>
                                                                    </div>
                                                                ) : (
                                                                    <div className={`text-2xl font-black animate-bounce ${computerAnswer === 'yes' ? 'text-green-600' : 'text-red-500'}`}>
                                                                        {computerAnswer === 'yes' ? "ÎÑ§! (Yes)" : "ÏïÑÎãàÏò§! (No)"}
                                                                    </div>
                                                                )}
                                                            </div>
                                                        )}
                                                        <div className="text-center text-xs text-slate-400 mt-2">
                                                            Ïª¥Ìì®ÌÑ∞Í∞Ä ÎπÑÎ∞Ä ÎèÑÌòïÏóê ÎßûÏ∂∞ ÎåÄÎãµÌï©ÎãàÎã§.
                                                        </div>
                                                    </div>
                                                ) : (
                                                    <div className="text-center p-6 bg-indigo-50 rounded-xl border border-indigo-100 animate-fade-in">
                                                        <Icon name="check-circle" className="mx-auto text-indigo-500 mb-3" size={32} />
                                                        <div className="text-indigo-900 font-bold text-lg mb-2">Î∂ÑÎ•òÍ∞Ä ÎÅùÎÇ¨ÏäµÎãàÎã§!</div>
                                                        
                                                        {!isRevealed ? (
                                                            <button 
                                                                onClick={() => setIsRevealed(true)}
                                                                className="w-full py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-bold transition shadow-md flex items-center justify-center gap-2"
                                                            >
                                                                <Icon name="eye" size={18} /> Ï†ïÏ≤¥ ÌôïÏù∏ (Í≥µÍ∞ú)
                                                            </button>
                                                        ) : (
                                                            <div className="mt-4 bg-white p-4 rounded-lg border border-indigo-100 animate-fade-in shadow-inner">
                                                                <div className="flex items-center justify-center gap-4 mb-4">
                                                                    <div className="flex flex-col items-center">
                                                                        <span className="text-[10px] font-bold text-slate-400 mb-1">Tree Result</span>
                                                                        <div className="p-2 bg-slate-100 rounded text-xs font-bold">{nodes[currentNodeId].text}</div>
                                                                    </div>
                                                                    <div className="text-xl font-bold text-slate-300">vs</div>
                                                                    <div className="flex flex-col items-center">
                                                                        <span className="text-[10px] font-bold text-blue-500 mb-1">Secret</span>
                                                                        {targetShape && <ShapeIcon item={targetShape} size={32} />}
                                                                    </div>
                                                                </div>
                                                                
                                                                {targetShape && nodes[currentNodeId].text.includes(targetShape.name.split(' ')[1]) ? (
                                                                    <div className="text-center text-green-600 font-bold text-sm mb-3">Ï†ïÎãµÏûÖÎãàÎã§! ÏôÑÎ≤ΩÌïú Ï∂îÎ¶¨ÎÑ§Ïöî! üéâ</div>
                                                                ) : (
                                                                    <div className="text-center text-slate-600 font-bold text-sm mb-3">
                                                                        {`Ïã§Ï†ú Ï†ïÏ≤¥Îäî '${targetShape?.name}'ÏòÄÏäµÎãàÎã§!`}
                                                                    </div>
                                                                )}

                                                                <button onClick={() => resetSolver(shapeData)} className="w-full py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded text-xs font-bold">
                                                                    ÏÉàÎ°úÏö¥ Í≤åÏûÑ ÏãúÏûë
                                                                </button>
                                                            </div>
                                                        )}
                                                    </div>
                                                )}
                                            </div>
                                        ) : null}
                                    </div>
                                </div>
                            )}

                            {/* Builder Sidebar */}
                            {appMode === 'builder' && (
                                <div className="flex-1 flex flex-col">
                                    <div className="p-4 border-b border-slate-100 bg-slate-50">
                                        <div className="flex items-center justify-between">
                                            <h2 className="text-sm font-bold text-slate-600 flex items-center gap-2">
                                                <Icon name="settings" size={16}/> Ìé∏Ïßë Ìå®ÎÑê
                                            </h2>
                                            <button 
                                                onClick={refreshData} 
                                                className="flex items-center gap-1.5 px-2 py-1 bg-white border border-slate-300 rounded text-xs font-bold text-slate-600 hover:bg-indigo-50 hover:text-indigo-600 hover:border-indigo-200 transition shadow-sm active:scale-95"
                                            >
                                                <Icon name="rotate-ccw" size={11} className={isAnimating ? 'animate-spin' : ''} />
                                                Îç∞Ïù¥ÌÑ∞ ÏÖîÌîå
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div className="flex-1 p-4 overflow-y-auto">
                                        {selectedNodeId && nodes[selectedNodeId] ? (
                                            <div className="space-y-6 animate-fade-in">
                                                
                                                {nodes[selectedNodeId].type === 'question' && (
                                                    <div className="bg-indigo-50 p-4 rounded-xl border border-indigo-100 shadow-sm">
                                                        <label className="block text-xs font-bold text-indigo-800 mb-3 flex items-center gap-1">
                                                            <Icon name="filter" size={12}/> Î∂ÑÎ•ò Í∑úÏπô (Yes Ï°∞Í±¥)
                                                        </label>
                                                        <div className="space-y-3">
                                                            <div className="flex flex-col gap-1">
                                                                <span className="text-[10px] text-indigo-500 font-semibold">Í∏∞Ï§Ä (Criteria)</span>
                                                                <select 
                                                                    className="w-full p-2.5 text-sm border border-indigo-200 rounded-lg bg-white focus:ring-2 focus:ring-indigo-500 outline-none"
                                                                    value={nodes[selectedNodeId].rule?.key || 'shape'}
                                                                    onChange={(e) => updateNodeRule(selectedNodeId, e.target.value, nodes[selectedNodeId].rule?.value || 'circle')}
                                                                >
                                                                    <option value="shape">Î™®Ïñë (Shape)</option>
                                                                    <option value="color">ÏÉâÍπî (Color)</option>
                                                                </select>
                                                            </div>
                                                            <div className="flex flex-col gap-1">
                                                                <span className="text-[10px] text-indigo-500 font-semibold">Í∞í (Value)</span>
                                                                <select 
                                                                    className="w-full p-2.5 text-sm border border-indigo-200 rounded-lg bg-white focus:ring-2 focus:ring-indigo-500 outline-none"
                                                                    value={nodes[selectedNodeId].rule?.value || ''}
                                                                    onChange={(e) => updateNodeRule(selectedNodeId, nodes[selectedNodeId].rule?.key || 'shape', e.target.value)}
                                                                >
                                                                    {nodes[selectedNodeId].rule?.key === 'shape' ? (
                                                                    <>
                                                                        <option value="circle">ÏõêÌòï</option>
                                                                        <option value="triangle">ÏÇºÍ∞ÅÌòï</option>
                                                                        <option value="square">ÏÇ¨Í∞ÅÌòï</option>
                                                                    </>
                                                                    ) : (
                                                                    <>
                                                                        <option value="red">Îπ®Í∞ï</option>
                                                                        <option value="blue">ÌååÎûë</option>
                                                                        <option value="yellow">ÎÖ∏Îûë</option>
                                                                    </>
                                                                    )}
                                                                </select>
                                                            </div>
                                                            <div className="text-[10px] text-indigo-600 bg-indigo-100/50 p-2 rounded">
                                                                * Í∑úÏπôÏùÑ Î≥ÄÍ≤ΩÌïòÎ©¥ ÏßàÎ¨∏ ÌÖçÏä§Ìä∏Í∞Ä ÏûêÎèôÏúºÎ°ú ÏóÖÎç∞Ïù¥Ìä∏Îê©ÎãàÎã§.
                                                            </div>
                                                        </div>
                                                    </div>
                                                )}

                                                <div>
                                                    <label className="block text-xs font-bold text-slate-500 mb-1">ÏßàÎ¨∏/Í≤∞Í≥º ÌÖçÏä§Ìä∏ ÏàòÏ†ï</label>
                                                    <input 
                                                        type="text" 
                                                        value={nodes[selectedNodeId].text} 
                                                        onChange={(e) => updateNodeText(selectedNodeId, e.target.value)} 
                                                        className="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none text-sm font-medium shadow-sm"
                                                    />
                                                </div>

                                                <div className="pt-4 border-t border-slate-100 flex gap-2">
                                                    {nodes[selectedNodeId].type === 'result' ? (
                                                        <button onClick={() => addBranch(selectedNodeId)} className="flex-1 bg-white border border-indigo-600 text-indigo-600 py-2.5 rounded-lg text-sm font-bold hover:bg-indigo-50 transition shadow-sm flex items-center justify-center gap-1">
                                                            <Icon name="plus" size={16}/> ÌïòÏúÑ ÏßàÎ¨∏ Ï∂îÍ∞Ä
                                                        </button>
                                                    ) : (
                                                        <button onClick={() => deleteChildren(selectedNodeId)} className="flex-1 bg-white border border-red-200 text-red-500 py-2.5 rounded-lg text-sm font-bold hover:bg-red-50 transition shadow-sm flex items-center justify-center gap-1">
                                                            <Icon name="trash-2" size={16}/> ÌïòÏúÑ Í∞ÄÏßÄ ÏÇ≠Ï†ú
                                                        </button>
                                                    )}
                                                </div>
                                            </div>
                                        ) : (
                                            <div className="text-center py-10 text-slate-400 text-sm border-2 border-dashed border-slate-200 rounded-xl">
                                                Ïò§Î•∏Ï™Ω Ìä∏Î¶¨ÏóêÏÑú <br/>ÎÖ∏ÎìúÎ•º ÌÅ¥Î¶≠ÌïòÏó¨ Ìé∏ÏßëÌïòÏÑ∏Ïöî.
                                            </div>
                                        )}
                                    </div>
                                    
                                    <div className="p-4 border-t border-slate-100 bg-slate-50 text-xs text-slate-500">
                                        <div className="font-bold mb-2">ÎèÑÌòï ÏïÑÏù¥ÏΩò Î≤îÎ°Ä</div>
                                        <div className="flex gap-3 justify-center">
                                            <div className="flex items-center gap-1"><span className="w-2 h-2 rounded-full bg-red-500"></span> Îπ®Í∞ï</div>
                                            <div className="flex items-center gap-1"><span className="w-2 h-2 rounded-full bg-blue-500"></span> ÌååÎûë</div>
                                            <div className="flex items-center gap-1"><span className="w-2 h-2 rounded-full bg-yellow-500"></span> ÎÖ∏Îûë</div>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </aside>

                        <section 
                            className="flex-1 overflow-auto bg-slate-50 relative cursor-move" 
                            onClick={() => setSelectedNodeId(null)}
                        >
                            <div className="absolute inset-0 opacity-[0.03]" style={{ backgroundImage: 'radial-gradient(#000 1px, transparent 1px)', backgroundSize: '20px 20px' }}></div>
                            <div className="min-w-full min-h-full flex justify-center p-20">
                                <TreeNode nodeId="root" />
                            </div>
                        </section>
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<DecisionTreeApp />);
    </script>
</body>
</html>
